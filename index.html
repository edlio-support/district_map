<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Address Checker</title>
    <style>
      #map {
        height: 0%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div>
      This is a proof of concept. The box below will tell you what imaginary schools in Austin your children would be assigned to. Results will appear in the console.
    </div>
    <input type="text" id="location"></input>
    <input type="button" id="submit" value="Check Location"></input>
    <div id="results"></div>
    <div id="map"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAf2xUELY06TyIxIK8I-atfPDxLE5dAn88&libraries=geometry&callback=initMap"
         async defer></script>
    <script type="text/javascript" src="js/schools.js"></script>
    <script type="text/javascript" src="js/map.js"></script>
    <script>

      // Initialize Map
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 30.267, lng: -97.743},
          zoom: 9,
        });

        var geocoder = new google.maps.Geocoder();

        var hsAreas = createBoundaries(hsCoords);
        var msAreas = createBoundaries(msCoords);
        var esAreas = createBoundaries(esCoords);

        var areas = [hsAreas, msAreas, esAreas];


        // Creates polygon for each school
        function createBoundaries(schools) {
          var area = []
          schools.forEach(function(coords){
            area.push(new google.maps.Polygon({paths: coords}));
          });
          return area;
        }

        // Listen for "Check Location" button
        document.getElementById('submit').addEventListener('click', function() {
          checkAddress(geocoder, map, areas, schools);
        });
      }


      // Checks to see what school the address would be assigned to and displays results
      function checkAddress(geocoder, resultsMap, areas, schools) {
        var address = document.getElementById('location').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {

            let latLng = results[0].geometry.location;
            let answer = document.getElementById('results');
            let poly = google.maps.geometry.poly;

            var hsID = schoolCheck(areas[0], poly, latLng);
            var msID = schoolCheck(areas[1], poly, latLng);
            var esID = schoolCheck(areas[2], poly, latLng);

            console.log(schools[0][hsID]);
            console.log(schools[1][msID]);
            console.log(schools[2][esID]);

          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

      function schoolCheck(areas, poly, latLng){
        let i = 0;
        var len = areas.length;
        areas.forEach(function(area){
          if(poly.containsLocation(latLng, area)){
            return i;
          } else {
            i++;
            if(i == len){
              console.log('not found');
              return;
            }
          }
        });
        return i;
      }
    </script>
  </body>
</html>
